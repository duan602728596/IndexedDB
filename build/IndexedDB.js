"use strict";var _slicedToArray=function(){function e(e,t){var n=[],r=!0,o=!1,s=void 0;try{for(var i,c=e[Symbol.iterator]();!(r=(i=c.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){o=!0,s=e}finally{try{!r&&c.return&&c.return()}finally{if(o)throw s}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e){"object"===("undefined"==typeof module?"undefined":_typeof(module))&&"object"===_typeof(module.exports)?module.exports=e(window):window.IndexedDB=e(window)}(function(e){function t(e){var t=null;if("number"==typeof e)t=e;else if("string"==typeof e)if(/^\s*>\s*(-?\d+(\.\d+)?)\s*$/i.test(e))t=IDBKeyRange.lowerBound(Number(e.match(/(-?\d+(\.\d+)?)/g)[0]),!0);else if(/^\s*>\s*=\s*(-?\d+(\.\d+)?)\s*$/i.test(e))t=IDBKeyRange.lowerBound(Number(e.match(/(-?\d+(\.\d+)?)/g)[0]));else if(/^\s*<\s*(-?\d+(\.\d+)?)\s*$/i.test(e))t=IDBKeyRange.upperBound(Number(e.match(/(-?\d+(\.\d+)?)/g)[0]),!0);else if(/^\s*<\s*=\s*(-?\d+(\.\d+)?)\s*$/i.test(e))t=IDBKeyRange.upperBound(Number(e.match(/(-?\d+(\.\d+)?)/g)[0]));else if(/^\s*[\[\(]\s*(-?\d+(\.\d+)?)\s*\,\s*(-?\d+(\.\d+)?)\s*[\]\)]\s*$/i.test(e)){var n=e.match(/(-?\d+(\.\d+)?)/g),r=_slicedToArray(n,2),o=r[0],s=r[1],i=!1,c=!1;/^.*\(.*$/.test(e)&&(i=!0),/^.*\).*$/.test(e)&&(c=!0),t=IDBKeyRange.bound(Number(o),Number(s),i,c)}else t=e;return t}function n(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n.prototype.indexeddb=n.indexeddb,n.prototype.Init.prototype=n.prototype,new n.prototype.Init(e,t,r)}function r(e,t,n){this.db=e;var r=!0===n?"readwrite":"readonly",o=this.db.transaction(t,r);return this.store=o.objectStore(t),this}return n.indexeddb=e.indexedDB||e.webkitIndexedDB||e.mozIndexedDB||e.msIndexedDB,n.deleteDatabase=function(e){n.indexeddb.deleteDatabase(e),console.log("删除数据库："+e+"。")},n.prototype.Init=function(e,t,n){return this.name=e,this.version=t,this.callbackObject=n,this.db=null,this.request=this.indexeddb.open(e,t),this._requestSuccess=function(e){console.log("打开数据库成功！\nname:    "+this.name+"\nversion: "+this.version),this.callbackObject.success&&(this.db=e.target.result,this.callbackObject.success.call(this,e.target,e))},this._requestError=function(e){console.log("打开数据库失败！\nname:    "+this.name+"\nversion: "+this.version),this.callbackObject.error&&(console.log(e.target.error.message),this.callbackObject.error.call(this,e.target.error,e))},this._requestUpgradeneeded=function(e){console.log("数据库版本更新！\nname:    "+this.name+"\nversion: "+this.version),this.callbackObject.upgradeneeded&&(this.db=e.target.result,this.callbackObject.upgradeneeded.call(this,e.target,e))},this.close=function(){this.db.close(),console.log("数据库关闭。\nname:    "+this.name+"\nversion: "+this.version)},this.hasObjectStore=function(e){return this.db.objectStoreNames.contains(e)},this.createObjectStore=function(e,t,n){if(this.hasObjectStore(e))console.log("ObjectStore："+e+"已存在。");else{var r=this.db.createObjectStore(e,{keyPath:t});if(n)for(var o=0,s=n.length;o<s;o++)r.createIndex(n[o].name,n[o].index,{unique:!!n[o].unique&&n[o].unique});console.log("创建了新的ObjectStore："+e+"。")}return this},this.deleteObjectStore=function(e){return this.hasObjectStore(e)?(this.db.deleteObjectStore(e),console.log("删除了新的ObjectStore："+e+"。")):console.log("ObjectStore："+e+"不存在。"),this},this.getObjectStore=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new r(this.db,e,t)},this.request.addEventListener("success",this._requestSuccess.bind(this),!1),this.request.addEventListener("error",this._requestError.bind(this),!1),this.request.addEventListener("upgradeneeded",this._requestUpgradeneeded.bind(this),!1),this},r.prototype.add=function(e){for(var t=0,n=(e=e instanceof Array?e:[e]).length-1;t<=n;t++)this.store.add(e[t]),t===n&&console.log("数据添加成功");return this},r.prototype.put=function(e){for(var t=0,n=(e=e instanceof Array?e:[e]).length-1;t<=n;t++)this.store.put(e[t]),t===n&&console.log("数据更新成功");return this},r.prototype.delete=function(e){for(var t=0,n=(e=e instanceof Array?e:[e]).length-1;t<=n;t++)this.store.delete(e[t]),t===n&&console.log("数据删除成功");return this},r.prototype.clear=function(e){return this.store.clear(),console.log("数据清除成功"),this},r.prototype.get=function(e,t){return this.store.get(e).addEventListener("success",function(e){t&&t.call(this,e.target.result,e)}.bind(this),!1),this},r.prototype.cursor=function(e){var n="function"==typeof arguments[1]?arguments[1]:arguments[2],r=this.store.index(e),o=arguments[2]?t(arguments[1]):null;return(null===o?r.openCursor():r.openCursor(o)).addEventListener("success",function(e){n&&n.call(this,e.target.result,e)}.bind(this),!1),this},n});